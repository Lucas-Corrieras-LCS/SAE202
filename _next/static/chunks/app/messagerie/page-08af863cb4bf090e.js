(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[26],{978:(e,t,s)=>{Promise.resolve().then(s.bind(s,2848))},2848:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var i=s(5155),a=s(2115),n=s(7771),r=s(6408),l=s(5666);function o(){return(0,i.jsx)("section",{className:"min-h-screen bg-gradient-to-br from-[#2D3670] via-[#1A2454] to-[#0D1A34] flex flex-col items-center justify-center",children:(0,i.jsxs)(r.P.div,{className:"bg-white/10 backdrop-blur-lg rounded-3xl shadow-2xl border border-white/10 p-8 max-w-md w-full text-center",initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{duration:.6},children:[(0,i.jsx)("h1",{className:"orbitron text-3xl font-bold text-white mb-4",children:"Messagerie"}),(0,i.jsx)("p",{className:"text-red-400",children:"Vous devez \xeatre connect\xe9 pour acc\xe9der \xe0 la messagerie."})]})})}function d(e){let{messages:t=[],admins:s=[],utilisateurs:a=[],destinataire:n,setDestinataire:o,contenu:d,setContenu:c,handleSend:m,handleDelete:u,isAdmin:x,error:h}=e;return(0,i.jsxs)("section",{className:"min-h-screen bg-gradient-to-br from-[#2D3670] via-[#1A2454] to-[#0D1A34] flex flex-col items-center justify-center px-2 py-10 relative",children:[(0,i.jsx)(l.kQ,{speed:-20,children:(0,i.jsx)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[60vw] h-[60vw] bg-purple-700/20 blur-3xl rounded-full z-0 pointer-events-none"})}),(0,i.jsxs)(r.P.div,{className:"relative z-10 w-full max-w-2xl bg-white/10 backdrop-blur-lg rounded-3xl shadow-2xl border border-white/10 p-8 md:p-12",initial:{opacity:0,y:40,scale:.97},animate:{opacity:1,y:0,scale:1},transition:{duration:.7,ease:[.25,.1,.25,1]},children:[(0,i.jsx)("h1",{className:"orbitron text-3xl md:text-4xl font-bold mb-8 text-white text-center",children:"Messagerie interne"}),(0,i.jsx)("h2",{className:"orbitron text-xl font-semibold mb-4 text-[#B0B4CC]",children:"Messages re\xe7us :"}),(0,i.jsx)("ul",{className:"space-y-3 mb-8",children:0===t.length?(0,i.jsx)(r.P.li,{className:"text-center text-[#B0B4CC]",initial:{opacity:0},animate:{opacity:1},transition:{duration:.4},children:"Aucun message re\xe7u."}):t.map((e,t)=>(0,i.jsxs)(r.P.li,{className:"bg-white/20 rounded-2xl px-4 py-3 flex flex-col md:flex-row md:items-center justify-between shadow",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.5,delay:.07*t},children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("span",{className:"font-semibold text-white",children:[e.expediteur_prenom," ",e.expediteur_nom]}),(0,i.jsxs)("span",{className:"text-[#B0B4CC] ml-2 text-sm",children:["(",e.expediteur_email,")"]}),(0,i.jsx)("div",{className:"text-white mt-1",children:e.contenu}),(0,i.jsx)("div",{className:"text-xs text-[#B0B4CC] mt-1",children:e.created_at})]}),(0,i.jsxs)("div",{className:"flex gap-2 mt-3 md:mt-0",children:[(0,i.jsx)(r.P.button,{className:"text-yellow-400 hover:text-yellow-300 underline font-semibold transition",whileHover:{scale:1.08},onClick:()=>o(e.expediteur_id),children:"R\xe9pondre"}),x&&(0,i.jsx)(r.P.button,{className:"text-red-400 hover:text-red-300 underline font-semibold transition",whileHover:{scale:1.08},onClick:()=>u(e.id),children:"Supprimer"})]})]},e.id))}),(0,i.jsx)("h2",{className:"orbitron text-xl font-semibold mb-4 text-[#B0B4CC]",children:"Envoyer un message"}),(0,i.jsxs)(r.P.form,{onSubmit:m,className:"space-y-5",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.7,delay:.1},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block font-semibold mb-1 text-[#B0B4CC]",children:"Destinataire :"}),(0,i.jsxs)("select",{className:"w-full rounded-xl px-4 py-2 bg-white/20 text-white border border-white/20 focus:outline-none focus:ring-2 focus:ring-[#6B21A8] transition",value:n,onChange:e=>o(e.target.value),required:!0,children:[(0,i.jsx)("option",{value:"",children:"-- Choisir un destinataire --"}),(0,i.jsx)("optgroup",{label:"Admins",children:s.map(e=>(0,i.jsxs)("option",{value:e.id,children:[e.prenom," ",e.nom," (",e.email,")"]},e.id))}),a.length>0&&(0,i.jsx)("optgroup",{label:"Utilisateurs",children:a.map(e=>(0,i.jsxs)("option",{value:e.id,children:[e.prenom," ",e.nom," (",e.email,")"]},e.id))})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block font-semibold mb-1 text-[#B0B4CC]",children:"Message :"}),(0,i.jsx)("textarea",{className:"w-full rounded-xl px-4 py-2 bg-white/20 text-white border border-white/20 focus:outline-none focus:ring-2 focus:ring-[#6B21A8] transition",value:d,onChange:e=>c(e.target.value),required:!0})]}),(0,i.jsx)(r.P.button,{type:"submit",className:"w-full mt-4 bg-gradient-to-r from-[#023377] to-[#6B21A8] text-white font-bold py-2 px-4 rounded-full shadow-lg transition-transform duration-300",whileHover:{scale:1.04},whileTap:{scale:.97},children:"Envoyer"}),h&&(0,i.jsx)("p",{className:"text-red-400 mt-2",children:h})]})]})]})}function c(){let[e,t]=(0,a.useState)(!1),[s,r]=(0,a.useState)(!1),[l,c]=(0,a.useState)([]),[m,u]=(0,a.useState)([]),[x,h]=(0,a.useState)([]),[p,f]=(0,a.useState)(null),[b,g]=(0,a.useState)(""),[j,w]=(0,a.useState)(""),[y,v]=(0,a.useState)("");(0,a.useEffect)(()=>{fetch("/sae202/?page=accueil&format=json",{credentials:"include"}).then(e=>e.json()).then(e=>{t(e.isConnected),r(e.isAdmin)})},[]),(0,a.useEffect)(()=>{fetch("/sae202/?page=messagerie&format=json",{credentials:"include"}).then(e=>e.json()).then(e=>{c(e.messages||[]),u(e.admins||[]),h(e.utilisateurs||[]),f(e.user_id)})},[]);let N=async e=>{e.preventDefault(),v(""),(await fetch("/sae202/?page=messagerie",{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({destinataire_id:b,contenu:j})})).ok?(w(""),g(""),c((await fetch("/sae202/?page=messagerie&format=json",{credentials:"include"}).then(e=>e.json())).messages||[])):v("Erreur lors de l'envoi")},C=async e=>{window.confirm("Supprimer ce message ?")&&(await fetch("/sae202/?page=supprimer_message&id=".concat(e),{credentials:"include"}),c((await fetch("/sae202/?page=messagerie&format=json",{credentials:"include"}).then(e=>e.json())).messages||[]))};return e?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.A,{isConnected:e,isAdmin:s}),(0,i.jsx)(d,{messages:l,admins:m,utilisateurs:x,destinataire:b,setDestinataire:g,contenu:j,setContenu:w,handleSend:N,handleDelete:C,isAdmin:s,error:y})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.A,{isConnected:!1,isAdmin:!1}),(0,i.jsx)(o,{})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[589,666,21,771,441,684,358],()=>t(978)),_N_E=e.O()}]);