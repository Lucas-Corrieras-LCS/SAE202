(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[26],{978:(e,s,n)=>{Promise.resolve().then(n.bind(n,2852))},2852:(e,s,n)=>{"use strict";n.r(s),n.d(s,{default:()=>i});var t=n(5155),a=n(2115),l=n(7583);function i(){let[e,s]=(0,a.useState)(!1),[n,i]=(0,a.useState)(!1),[r,o]=(0,a.useState)([]),[c,d]=(0,a.useState)([]),[x,m]=(0,a.useState)([]),[h,u]=(0,a.useState)(null),[p,j]=(0,a.useState)(""),[f,g]=(0,a.useState)(""),[b,w]=(0,a.useState)("");(0,a.useEffect)(()=>{fetch("/sae202/?page=accueil&format=json",{credentials:"include"}).then(e=>e.json()).then(e=>{s(e.isConnected),i(e.isAdmin)})},[]),(0,a.useEffect)(()=>{fetch("/sae202/?page=messagerie&format=json",{credentials:"include"}).then(e=>e.json()).then(e=>{o(e.messages||[]),d(e.admins||[]),m(e.utilisateurs||[]),u(e.user_id)})},[]);let y=async e=>{e.preventDefault(),w(""),(await fetch("/sae202/?page=messagerie",{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({destinataire_id:p,contenu:f})})).ok?(g(""),j(""),o((await fetch("/sae202/?page=messagerie&format=json",{credentials:"include"}).then(e=>e.json())).messages||[])):w("Erreur lors de l'envoi")},N=async e=>{window.confirm("Supprimer ce message ?")&&(await fetch("/sae202/?page=supprimer_message&id=".concat(e),{credentials:"include"}),o((await fetch("/sae202/?page=messagerie&format=json",{credentials:"include"}).then(e=>e.json())).messages||[]))};return e?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.A,{isConnected:e,isAdmin:n}),(0,t.jsxs)("div",{className:"max-w-2xl mx-auto mt-8 p-6 bg-white rounded shadow",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold mb-6 text-gray-800",children:"Messagerie interne"}),(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4 text-gray-700",children:"Messages re\xe7us :"}),(0,t.jsx)("ul",{className:"space-y-2 mb-6",children:r.map(e=>(0,t.jsxs)("li",{className:"bg-gray-100 rounded px-3 py-2 flex flex-col md:flex-row md:items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("span",{className:"font-semibold",children:[e.expediteur_prenom," ",e.expediteur_nom]}),(0,t.jsxs)("span",{className:"text-gray-500 ml-2",children:["(",e.expediteur_email,")"]}),(0,t.jsx)("div",{className:"text-gray-800",children:e.contenu}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:e.created_at})]}),(0,t.jsxs)("div",{className:"flex gap-2 mt-2 md:mt-0",children:[(0,t.jsx)("button",{className:"text-yellow-600 underline",onClick:()=>j(e.expediteur_id),children:"R\xe9pondre"}),n&&(0,t.jsx)("button",{className:"text-red-600 underline",onClick:()=>N(e.id),children:"Supprimer"})]})]},e.id))}),(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4 text-gray-700",children:"Envoyer un message"}),(0,t.jsxs)("form",{onSubmit:y,className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block font-semibold mb-1",children:"Destinataire :"}),(0,t.jsxs)("select",{className:"w-full border rounded px-3 py-2",value:p,onChange:e=>j(e.target.value),required:!0,children:[(0,t.jsx)("option",{value:"",children:"-- Choisir un destinataire --"}),(0,t.jsx)("optgroup",{label:"Admins",children:c.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.prenom," ",e.nom," (",e.email,")"]},e.id))}),x.length>0&&(0,t.jsx)("optgroup",{label:"Utilisateurs",children:x.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.prenom," ",e.nom," (",e.email,")"]},e.id))})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block font-semibold mb-1",children:"Message :"}),(0,t.jsx)("textarea",{className:"w-full border rounded px-3 py-2",value:f,onChange:e=>g(e.target.value),required:!0})]}),(0,t.jsx)("button",{type:"submit",className:"bg-yellow-400 hover:bg-yellow-500 text-gray-900 font-bold py-2 px-4 rounded transition",children:"Envoyer"}),b&&(0,t.jsx)("p",{className:"text-red-600 mt-2",children:b})]})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.A,{isConnected:!1,isAdmin:!1}),(0,t.jsxs)("div",{className:"max-w-xl mx-auto mt-8 p-6 bg-white rounded shadow",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold mb-6 text-gray-800",children:"Messagerie"}),(0,t.jsx)("p",{className:"text-red-600",children:"Vous devez \xeatre connect\xe9 pour acc\xe9der \xe0 la messagerie."})]})]})}},7583:(e,s,n)=>{"use strict";n.d(s,{A:()=>i});var t=n(5155),a=n(6874),l=n.n(a);function i(e){let{isConnected:s,isAdmin:n}=e;return(0,t.jsx)("nav",{className:"bg-gray-900 text-white shadow mb-8",children:(0,t.jsxs)("ul",{className:"flex flex-wrap items-center gap-4 px-6 py-3",children:[(0,t.jsx)("li",{children:(0,t.jsx)(l(),{href:"/",className:"hover:text-yellow-400 font-semibold transition",children:"Accueil"})}),(0,t.jsx)("li",{children:(0,t.jsx)(l(),{href:"/concept",className:"hover:text-yellow-400 transition",children:"Concept"})}),(0,t.jsx)("li",{children:(0,t.jsx)(l(),{href:"/infos",className:"hover:text-yellow-400 transition",children:"Infos pratiques"})}),s?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("li",{children:(0,t.jsx)(l(),{href:"/messagerie",className:"hover:text-yellow-400 transition",children:"Messagerie interne"})}),(0,t.jsx)("li",{children:(0,t.jsx)(l(),{href:"/profil",className:"hover:text-yellow-400 transition",children:"Mon profil"})}),n&&(0,t.jsx)("li",{children:(0,t.jsx)(l(),{href:"/gestion",className:"hover:text-red-400 font-bold transition",children:"Admin"})}),(0,t.jsx)("li",{children:(0,t.jsx)("button",{className:"hover:text-yellow-400 transition bg-transparent border-none p-0 m-0 cursor-pointer",style:{background:"none"},onClick:async e=>{e.preventDefault();try{(await fetch("/sae202/?page=deconnexion",{method:"GET",credentials:"include",headers:{Accept:"application/json"}})).ok?window.location.href="/":alert("Erreur lors de la d\xe9connexion")}catch(e){alert("Erreur lors de la d\xe9connexion")}},children:"D\xe9connexion"})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("li",{children:(0,t.jsx)(l(),{href:"/inscription",className:"hover:text-yellow-400 transition",children:"Inscription"})}),(0,t.jsx)("li",{children:(0,t.jsx)(l(),{href:"/connexion",className:"hover:text-yellow-400 transition",children:"Connexion"})})]}),(0,t.jsx)("li",{children:(0,t.jsx)(l(),{href:"/mentions-legales",className:"hover:text-yellow-400 transition",children:"Mentions l\xe9gales"})})]})})}}},e=>{var s=s=>e(e.s=s);e.O(0,[874,441,684,358],()=>s(978)),_N_E=e.O()}]);